generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

model SponsorshipApplication {
  id          String                    @id @default(uuid())
  userId      String
  tierId      String
  fullName    String
  email       String
  reason      String
  status      SponsorshipApplicationStatus @default(PENDING)
  attachments Json                      @default("[]")
  voiceNote   String?
  createdAt   DateTime                  @default(now())
  updatedAt   DateTime                  @updatedAt
  user        User                      @relation(fields: [userId], references: [id])
  tier        SponsorshipTier           @relation(fields: [tierId], references: [id])

  @@map("sponsorship_applications")
}

model SponsorshipTier {
  id          String   @id @default(uuid())
  name        String   @unique // "free", "bronze", "silver", "gold", "platinum"
  displayName String   // "Free", "Bronze", "Silver", "Gold", "Platinum"
  price       Decimal  @default(0)
  currency    String   @default("NGN")
  benefits    Json     @default("[]")
  isActive    Boolean  @default(true)
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt
  users       User[]
  applications SponsorshipApplication[]

  @@map("sponsorship_tiers")
}

model User {
  id                    String                    @id @default(uuid())
  email                 String                    @unique
  username              String?                   @unique
  firstName             String
  lastName              String
  phoneNumber           String?                   @unique
  referralCode          String?                   @unique
  bio                   String?
  hourlyRate            Decimal?
  role                  UserRole                  @default(FREELANCER)
  status                UserStatus                @default(ACTIVE)
  lastLoginAt           DateTime?
  createdAt             DateTime                  @default(now())
  updatedAt             DateTime                  @updatedAt
  appleId               String?                   @unique
  authProvider          AuthProvider              @default(LOCAL)
  googleId              String?                   @unique
  linkedinId            String?                   @unique
  address               String?
  availabilityStatus    String?                   @default("available")
  city                  String?
  country               String?
  coverImageUrl         String?
  dateOfBirth           DateTime?
  deletedAt             DateTime?
  displayName           String?
  emailVerifiedAt       DateTime?
  experiencePoints      Int                       @default(0)
  gender                String?
  kycVerifiedAt         DateTime?
  lastActiveAt          DateTime?
  level                 Int                       @default(1)
  loginCount            Int                       @default(0)
  phoneVerifiedAt       DateTime?
  portfolioUrl          String?
  profileImageUrl       String?
  reputationScore       Decimal?                  @default(0.00)
  state                 String?
  subscriptionExpiresAt DateTime?
  subscriptionTier      String?                   @default("free") // "free", "bronze", "silver", "gold", "platinum"
  sponsorshipTier       SponsorshipTier?          @relation(fields: [subscriptionTier], references: [name])
  timezone              String?
  title                 String?
  twoFactorEnabled      Boolean                   @default(false)
  twoFactorSecret       String?
  websiteUrl            String?
  yearsOfExperience     Int?
  specialty             String?
  // Settings fields
  emailNotifications    Boolean                   @default(true)
  smsNotifications      Boolean                   @default(false)
  marketingEmails       Boolean                   @default(true)
  twoFactorAuth         Boolean                   @default(false)
  loginAlerts           Boolean                   @default(true)
  sessionTimeout        Boolean                   @default(true)
  profileVisibility     String                    @default("public")
  language              String                    @default("en")
  currency              String                    @default("NGN")
  dateFormat            String                    @default("DD/MM/YYYY")
  timeFormat            String                    @default("24h")
  theme                 String                    @default("light")
  compactMode           Boolean                   @default(false)
  showOnlineStatus      Boolean                   @default(true)
  allowSearchEngineIndexing Boolean               @default(true)
  challengeParticipants ChallengeParticipant[]
  challenges            Challenge[]               @relation("CreatedChallenges")
  sponsoredChallenges   Challenge[]               @relation("SponsoredChallenges")
  conversations         ConversationParticipant[]
  files                 File[]                    @relation("UploadedFiles")
  applications          JobApplication[]
  awardedJobs           Job[]                     @relation("AwardedJobs")
  jobs                  Job[]                     @relation("ClientJobs")
  jobQuestions          JobQuestion[]             @relation("FreelancerQuestions")
  messageReads          MessageRead[]             @relation("MessageReads")
  messageReactions      MessageReaction[]         @relation("MessageReactions")
  messageMentions       MessageMention[]          @relation("MessageMentions")
  messageDeliveries     MessageDelivery[]         @relation("MessageDeliveries")
  messageModerations    MessageModeration[]       @relation("MessageModerations")
  messages              Message[]
  notifications         Notification[]
  paymentMethods        PaymentMethod[]
  portfolios            Portfolio[]
  projectMembers        ProjectMember[]
  milestones            ProjectMilestone[]
  progressUpdates       ProjectProgressUpdate[] @relation("ProgressUpdates")
  progressConfirmations ProjectProgressUpdate[] @relation("ProgressConfirmations")
  clientProjects        Project[]                 @relation("ClientProjects")
  freelancerProjects    Project[]                 @relation("FreelancerProjects")
  reviewsReceived       Review[]                  @relation("ReviewsOfUser")
  reviews               Review[]                  @relation("ReviewsByUser")
  transactions          Transaction[]
  achievements          UserAchievement[]
  analytics             UserAnalytics[]
  skills                UserSkill[]               @relation("UserSkills")
  skillVerifications    UserSkill[]               @relation("SkillVerifications")
  socialProfiles        UserSocialProfile[]
  wallets               Wallet[]
  sponsorshipApplications SponsorshipApplication[]
  sessions              UserSession[]
  loginHistory          LoginHistory[]
  bankAccounts          BankAccount[]
  paymentCards          PaymentCard[]
  rewards               Reward[]
  rewardStats           UserRewardStats?
  referrals             Referral[]             @relation("ReferrerReferrals")
  referredBy            Referral[]             @relation("RefereeReferrals")
  streaks               UserStreak[]
  badges                UserBadge[]
  leaderboardEntries    LeaderboardEntry[]
  clientContracts       Contract[]             @relation("ClientContracts")
  freelancerContracts   Contract[]             @relation("FreelancerContracts")
  raisedDisputes        Dispute[]              @relation("RaisedDisputes")
  disputesAgainst       Dispute[]              @relation("DisputesAgainst")
  resolvedDisputes      Dispute[]              @relation("ResolvedDisputes")
  disputeResponses      DisputeResponse[]

  @@map("users")
}

model UserSession {
  id           String   @id @default(uuid())
  userId       String
  deviceInfo   String
  ipAddress    String
  location     String?
  userAgent    String?
  isActive     Boolean  @default(true)
  lastActiveAt DateTime @default(now())
  createdAt    DateTime @default(now())
  user         User     @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@unique([userId, userAgent])
  @@map("user_sessions")
}

model LoginHistory {
  id         String      @id @default(uuid())
  userId     String
  deviceInfo String
  ipAddress  String
  location   String?
  userAgent  String?
  status     LoginStatus @default(SUCCESS)
  createdAt  DateTime    @default(now())
  user       User        @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@map("login_history")
}

model BankAccount {
  id            String              @id @default(uuid())
  userId        String
  bankName      String
  bankCode      String?
  accountNumber String
  accountName   String
  isDefault     Boolean             @default(false)
  isVerified    Boolean             @default(false)
  status        PaymentMethodStatus @default(ACTIVE)
  createdAt     DateTime            @default(now())
  updatedAt     DateTime            @updatedAt
  user          User                @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@map("bank_accounts")
}

model PaymentCard {
  id         String              @id @default(uuid())
  userId     String
  cardType   String              // visa, mastercard, verve
  last4      String
  expiryMonth String
  expiryYear String
  cardToken  String?
  isDefault  Boolean             @default(false)
  isVerified Boolean             @default(false)
  status     PaymentMethodStatus @default(ACTIVE)
  createdAt  DateTime            @default(now())
  updatedAt  DateTime            @updatedAt
  user       User                @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@map("payment_cards")
}

model UserSkill {
  id               String   @id @default(uuid())
  userId           String
  skillName        String
  proficiencyLevel Int
  yearsExperience  Decimal?
  isVerified       Boolean  @default(false)
  verifiedBy       String?
  createdAt        DateTime @default(now())
  user             User     @relation("UserSkills", fields: [userId], references: [id], onDelete: Cascade)
  verifier         User?    @relation("SkillVerifications", fields: [verifiedBy], references: [id])

  @@map("user_skills")
}

model UserSocialProfile {
  id               String   @id @default(uuid())
  userId           String
  platform         String
  profileUrl       String
  username         String?
  isVerified       Boolean  @default(false)
  verificationData Json?
  createdAt        DateTime @default(now())
  user             User     @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@map("user_social_profiles")
}

model Category {
  id          String     @id @default(uuid())
  name        String     @unique
  description String?
  icon        String?
  isActive    Boolean    @default(true)
  parentId    String?
  createdAt   DateTime   @default(now())
  parent      Category?  @relation("CategoryHierarchy", fields: [parentId], references: [id])
  children    Category[] @relation("CategoryHierarchy")
  jobs        Job[]

  @@map("categories")
}

model Job {
  id                  String           @id @default(uuid())
  title               String
  description         String
  budgetType          BudgetType       @default(FIXED)
  durationType        DurationType     @default(DAYS)
  experienceLevel     ExperienceLevel  @default(INTERMEDIATE)
  status              JobStatus        @default(DRAFT)
  isUrgent            Boolean          @default(false)
  allowQuestions      Boolean          @default(true)
  requireCoverLetter  Boolean          @default(true)
  clientId            String
  awardedTo           String?
  createdAt           DateTime         @default(now())
  updatedAt           DateTime         @updatedAt
  applicationCount    Int              @default(0)
  applicationDeadline DateTime?
  autoAward           Boolean          @default(false)
  awardedAt           DateTime?
  budgetMax           Decimal?
  budgetMin           Decimal?
  categoryId          String?
  completedAt         DateTime?
  currency            String           @default("NGN")
  deadline            DateTime?
  deletedAt           DateTime?
  deliverables        String?
  coreFeatures        Json             @default("[]")
  timeline            Json             @default("[]")
  referenceLinks      Json             @default("[]")
  managedByNairagig   Boolean          @default(false)
  estimatedDuration   Int?
  images              String[]
  isFeatured          Boolean          @default(false)
  maxApplications     Int?
  preferredSkills     String[]
  requiredSkills      String[]
  requirements        String?
  startedAt           DateTime?
  viewCount           Int              @default(0)
  visibility          JobVisibility    @default(PUBLIC)
  attachments         Json             @default("[]")
  applications        JobApplication[]
  questions           JobQuestion[]
  awardedFreelancer   User?            @relation("AwardedJobs", fields: [awardedTo], references: [id])
  category            Category?        @relation(fields: [categoryId], references: [id])
  client              User             @relation("ClientJobs", fields: [clientId], references: [id])
  project             Project?
  contracts           Contract[]
  disputes            Dispute[]

  @@map("jobs")
}

model JobApplication {
  id                 String            @id @default(uuid())
  jobId              String
  freelancerId       String
  coverLetter        String
  proposedBudget     Decimal?
  status             ApplicationStatus @default(PENDING)
  attachments        Json              @default("[]")
  clientFeedback     String?
  freelancerResponse String?
  portfolioItems     Json              @default("[]")
  proposedTimeline   Int?
  respondedAt        DateTime?
  reviewedAt         DateTime?
  submittedAt        DateTime          @default(now())
  timelineUnit       String?
  freelancer         User              @relation(fields: [freelancerId], references: [id], onDelete: Cascade)
  job                Job               @relation(fields: [jobId], references: [id], onDelete: Cascade)

  @@unique([jobId, freelancerId])
  @@map("job_applications")
}

model JobQuestion {
  id           String   @id @default(uuid())
  jobId        String
  freelancerId String
  question     String
  answer       String?
  isAnswered   Boolean  @default(false)
  isPublic     Boolean  @default(true)
  createdAt    DateTime @default(now())
  answeredAt   DateTime?
  job          Job      @relation(fields: [jobId], references: [id], onDelete: Cascade)
  freelancer   User     @relation("FreelancerQuestions", fields: [freelancerId], references: [id], onDelete: Cascade)

  @@map("job_questions")
}

model Project {
  id                 String             @id @default(uuid())
  description        String?
  status             ProjectStatus      @default(PLANNING)
  startDate          DateTime?
  endDate            DateTime?
  createdAt          DateTime           @default(now())
  updatedAt          DateTime           @updatedAt
  agreedBudget       Decimal
  clientId           String
  completedAt        DateTime?
  contractTerms      String?
  currency           String             @default("NGN")
  deliverables       Json               @default("[]")
  estimatedHours     Int?
  finalDeliverables  Json               @default("[]")
  freelancerId       String
  jobId              String?            @unique
  paymentSchedule    PaymentSchedule    @default(MILESTONE)
  progressPercentage Int                @default(0)
  requirements       String?
  revisionLimit      Int                @default(3)
  revisionsUsed      Int                @default(0)
  title              String
  conversations      Conversation[]
  members            ProjectMember[]
  milestones         ProjectMilestone[]
  progressUpdates    ProjectProgressUpdate[]
  client             User               @relation("ClientProjects", fields: [clientId], references: [id])
  freelancer         User               @relation("FreelancerProjects", fields: [freelancerId], references: [id])
  job                Job?               @relation(fields: [jobId], references: [id])
  reviews            Review[]
  contract           Contract?
  disputes           Dispute[]

  @@map("projects")
}

model ProjectMember {
  id        String      @id @default(uuid())
  projectId String
  userId    String
  role      ProjectRole @default(MEMBER)
  joinedAt  DateTime    @default(now())
  project   Project     @relation(fields: [projectId], references: [id], onDelete: Cascade)
  user      User        @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@unique([projectId, userId])
  @@map("project_members")
}

model ProjectMilestone {
  id               String          @id @default(uuid())
  projectId        String
  createdBy        String
  title            String
  description      String?
  deliverables     String?
  amount           Decimal
  dueDate          DateTime?
  orderIndex       Int
  status           MilestoneStatus @default(PENDING)
  submittedAt      DateTime?
  approvedAt       DateTime?
  paidAt           DateTime?
  clientFeedback   String?
  freelancerNotes  String?
  deliverableFiles Json            @default("[]")
  createdAt        DateTime        @default(now())
  creator          User            @relation(fields: [createdBy], references: [id])
  project          Project         @relation(fields: [projectId], references: [id], onDelete: Cascade)

  @@map("project_milestones")
}

model ProjectProgressUpdate {
  id                String   @id @default(uuid())
  projectId         String
  updatedBy         String
  oldProgress       Int
  newProgress       Int
  reason            String?
  messageId         String?
  status            ProgressUpdateStatus @default(PENDING)
  confirmedAt       DateTime?
  confirmedBy       String?
  changeRequested   Boolean  @default(false)
  changeReason      String?
  createdAt         DateTime @default(now())
  project           Project  @relation(fields: [projectId], references: [id], onDelete: Cascade)
  updater           User     @relation("ProgressUpdates", fields: [updatedBy], references: [id])
  confirmer         User?    @relation("ProgressConfirmations", fields: [confirmedBy], references: [id])
  message           Message? @relation(fields: [messageId], references: [id])

  @@map("project_progress_updates")
}

model Wallet {
  id                     String        @id @default(uuid())
  userId                 String
  availableBalance       Decimal       @default(0.00)
  pendingBalance         Decimal       @default(0.00)
  escrowBalance          Decimal       @default(0.00)
  totalEarned            Decimal       @default(0.00)
  totalWithdrawn         Decimal       @default(0.00)
  currency               String        @default("NGN")
  status                 WalletStatus  @default(ACTIVE)
  isVerified             Boolean       @default(false)
  dailyWithdrawalLimit   Decimal       @default(100000.00)
  monthlyWithdrawalLimit Decimal       @default(1000000.00)
  createdAt              DateTime      @default(now())
  updatedAt              DateTime      @updatedAt
  transactions           Transaction[]
  user                   User          @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@unique([userId, currency])
  @@map("wallets")
}

model Transaction {
  id                String            @id @default(uuid())
  userId            String
  amount            Decimal
  type              TransactionType
  status            TransactionStatus @default(PENDING)
  description       String?
  metadata          Json              @default("{}")
  createdAt         DateTime          @default(now())
  updatedAt         DateTime          @updatedAt
  currency          String            @default("NGN")
  failedAt          DateTime?
  failureReason     String?
  gatewayFee        Decimal           @default(0.00)
  gatewayProvider   String?
  gatewayReference  String?
  gatewayResponse   Json?
  netAmount         Decimal?
  platformFee       Decimal           @default(0.00)
  processedAt       DateTime?
  referenceId       String?           @unique
  relatedEntityId   String?
  relatedEntityType String?
  walletId          String?
  user              User              @relation(fields: [userId], references: [id], onDelete: Cascade)
  wallet            Wallet?           @relation(fields: [walletId], references: [id])

  @@map("transactions")
}

model PaymentMethod {
  id                    String              @id @default(uuid())
  userId                String
  type                  PaymentMethodType
  provider              String?
  bankName              String?
  bankCode              String?
  accountNumber         String?
  accountName           String?
  cardLastFour          String?
  cardBrand             String?
  cardToken             String?
  phoneNumber           String?
  networkProvider       String?
  isVerified            Boolean             @default(false)
  isDefault             Boolean             @default(false)
  status                PaymentMethodStatus @default(ACTIVE)
  verificationReference String?
  verifiedAt            DateTime?
  createdAt             DateTime            @default(now())
  updatedAt             DateTime            @updatedAt
  user                  User                @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@map("payment_methods")
}

model Conversation {
  id                 String                    @id @default(uuid())
  type               ConversationType          @default(DIRECT)
  projectId          String?
  challengeId        String?
  title              String?
  description        String?
  status             ConversationStatus        @default(ACTIVE)
  lastMessageAt      DateTime?
  lastMessagePreview String?
  isArchived         Boolean                   @default(false)
  isPinned           Boolean                   @default(false)
  muteUntil          DateTime?
  customData         Json                      @default("{}")
  tags               String[]                  @default([])
  priority           ConversationPriority      @default(NORMAL)
  autoArchiveAfter   Int?
  createdAt          DateTime                  @default(now())
  updatedAt          DateTime                  @updatedAt
  participants       ConversationParticipant[]
  settings           ConversationSettings?
  labels             ConversationLabel[]
  security           ConversationSecurity?
  challenge          Challenge?                @relation(fields: [challengeId], references: [id])
  project            Project?                  @relation(fields: [projectId], references: [id])
  messages           Message[]

  @@map("conversations")
}

model ConversationSettings {
  id               String       @id @default(uuid())
  conversationId   String       @unique
  allowFileSharing Boolean      @default(true)
  allowReactions   Boolean      @default(true)
  allowThreads     Boolean      @default(true)
  maxFileSize      Int          @default(10485760)
  retentionDays    Int?
  createdAt        DateTime     @default(now())
  updatedAt        DateTime     @updatedAt
  conversation     Conversation @relation(fields: [conversationId], references: [id], onDelete: Cascade)

  @@map("conversation_settings")
}

model ConversationLabel {
  id             String       @id @default(uuid())
  conversationId String
  name           String
  color          String       @default("#6B7280")
  createdAt      DateTime     @default(now())
  conversation   Conversation @relation(fields: [conversationId], references: [id], onDelete: Cascade)

  @@unique([conversationId, name])
  @@map("conversation_labels")
}

model ConversationSecurity {
  id             String       @id @default(uuid())
  conversationId String       @unique
  isEncrypted    Boolean      @default(false)
  keyRotationAt  DateTime?
  encryptionKey  String?
  createdAt      DateTime     @default(now())
  updatedAt      DateTime     @updatedAt
  conversation   Conversation @relation(fields: [conversationId], references: [id], onDelete: Cascade)

  @@map("conversation_security")
}

model ConversationParticipant {
  id               String          @id @default(uuid())
  conversationId   String
  userId           String
  role             ParticipantRole @default(MEMBER)
  permissions      Json            @default("{}")
  isActive         Boolean         @default(true)
  mutedUntil       DateTime?
  customTitle      String?
  notifyOnMessage  Boolean         @default(true)
  notifyOnMention  Boolean         @default(true)
  notifyOnReaction Boolean         @default(false)
  joinedAt         DateTime        @default(now())
  lastReadAt       DateTime?
  conversation     Conversation    @relation(fields: [conversationId], references: [id], onDelete: Cascade)
  user             User            @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@unique([conversationId, userId])
  @@map("conversation_participants")
}

model Message {
  id             String        @id @default(uuid())
  content        String?
  senderId       String
  messageType    MessageType   @default(TEXT)
  createdAt      DateTime      @default(now())
  conversationId String
  deletedAt      DateTime?
  editedAt       DateTime?
  isDeleted      Boolean       @default(false)
  isEdited       Boolean       @default(false)
  replyToId      String?
  threadId       String?
  threadCount    Int           @default(0)
  attachments    Json          @default("[]")
  isSystemMessage Boolean      @default(false)
  systemData     Json?
  actionType     String?
  actionData     Json?
  priority       MessagePriority @default(NORMAL)
  reads          MessageRead[]
  reactions      MessageReaction[]
  mentions       MessageMention[]
  deliveries     MessageDelivery[]
  progressUpdates ProjectProgressUpdate[]
  moderation     MessageModeration?
  conversation   Conversation  @relation(fields: [conversationId], references: [id], onDelete: Cascade)
  replyTo        Message?      @relation("MessageReplies", fields: [replyToId], references: [id])
  replies        Message[]     @relation("MessageReplies")
  thread         Message?      @relation("MessageThread", fields: [threadId], references: [id])
  threadMessages Message[]     @relation("MessageThread")
  sender         User          @relation(fields: [senderId], references: [id], onDelete: Cascade)

  @@map("messages")
}

model MessageReaction {
  id        String   @id @default(uuid())
  messageId String
  userId    String
  emoji     String
  createdAt DateTime @default(now())
  message   Message  @relation(fields: [messageId], references: [id], onDelete: Cascade)
  user      User     @relation("MessageReactions", fields: [userId], references: [id], onDelete: Cascade)

  @@unique([messageId, userId, emoji])
  @@map("message_reactions")
}

model MessageMention {
  id        String   @id @default(uuid())
  messageId String
  userId    String
  createdAt DateTime @default(now())
  message   Message  @relation(fields: [messageId], references: [id], onDelete: Cascade)
  user      User     @relation("MessageMentions", fields: [userId], references: [id], onDelete: Cascade)

  @@unique([messageId, userId])
  @@map("message_mentions")
}

model MessageDelivery {
  id          String         @id @default(uuid())
  messageId   String
  userId      String
  status      DeliveryStatus @default(SENT)
  deliveredAt DateTime?
  failedAt    DateTime?
  retryCount  Int            @default(0)
  message     Message        @relation(fields: [messageId], references: [id], onDelete: Cascade)
  user        User           @relation("MessageDeliveries", fields: [userId], references: [id], onDelete: Cascade)

  @@unique([messageId, userId])
  @@map("message_deliveries")
}

model MessageModeration {
  id          String           @id @default(uuid())
  messageId   String           @unique
  status      ModerationStatus @default(PENDING)
  flagReason  String?
  moderatedBy String?
  moderatedAt DateTime?
  message     Message          @relation(fields: [messageId], references: [id], onDelete: Cascade)
  moderator   User?            @relation("MessageModerations", fields: [moderatedBy], references: [id])

  @@map("message_moderations")
}

model MessageRead {
  id        String   @id @default(uuid())
  messageId String
  userId    String
  readAt    DateTime @default(now())
  message   Message  @relation(fields: [messageId], references: [id], onDelete: Cascade)
  user      User     @relation("MessageReads", fields: [userId], references: [id], onDelete: Cascade)

  @@unique([messageId, userId])
  @@map("message_reads")
}

model File {
  id              String         @id @default(uuid())
  uploadedBy      String?
  originalName    String
  fileName        String
  filePath        String
  fileSize        BigInt
  mimeType        String
  fileExtension   String?
  fileCategory    FileCategory?
  storageProvider String         @default("local")
  storagePath     String?
  cdnUrl          String?
  width           Int?
  height          Int?
  duration        Int?
  visibility      FileVisibility @default(PRIVATE)
  accessToken     String?
  downloadCount   Int            @default(0)
  status          FileStatus     @default(ACTIVE)
  isScanned       Boolean        @default(false)
  scanResult      String?
  scannedAt       DateTime?
  createdAt       DateTime       @default(now())
  updatedAt       DateTime       @updatedAt
  uploader        User?          @relation("UploadedFiles", fields: [uploadedBy], references: [id])

  @@map("files")
}

model Challenge {
  id                 String                 @id @default(uuid())
  title              String
  description        String
  requirements       String
  maxParticipants    Int?
  status             ChallengeStatus        @default(DRAFT)
  createdBy          String
  createdAt          DateTime               @default(now())
  updatedAt          DateTime               @updatedAt
  category           String
  currency           String                 @default("NGN")
  difficultyLevel    DifficultyLevel        @default(INTERMEDIATE)
  entryFee           Decimal                @default(0)
  isFeatured         Boolean                @default(false)
  isTeamChallenge    Boolean                @default(false)
  judgingCriteria    String?
  judgingEnd         DateTime
  maxTeamSize        Int                    @default(1)
  minParticipants    Int                    @default(1)
  participantCount   Int                    @default(0)
  referenceMaterials Json                   @default("[]")
  registrationEnd    DateTime
  registrationStart  DateTime
  sponsorId          String?
  starterFiles       Json                   @default("[]")
  submissionCount    Int                    @default(0)
  submissionEnd      DateTime
  submissionFormat   String?
  submissionStart    DateTime
  tags               String[]
  totalPrizePool     Decimal
  viewCount          Int                    @default(0)
  visibility         ChallengeVisibility    @default(PUBLIC)
  winnerDistribution Json?
  participants       ChallengeParticipant[]
  submissions        ChallengeSubmission[]
  creator            User                   @relation("CreatedChallenges", fields: [createdBy], references: [id])
  sponsor            User?                  @relation("SponsoredChallenges", fields: [sponsorId], references: [id])
  conversations      Conversation[]

  @@map("challenges")
}

model ChallengeParticipant {
  id               String                @id @default(uuid())
  challengeId      String
  userId           String
  teamName         String?
  registeredAt     DateTime              @default(now())
  entryFeePaid     Boolean               @default(false)
  paymentReference String?
  status           ParticipantStatus     @default(REGISTERED)
  challenge        Challenge             @relation(fields: [challengeId], references: [id], onDelete: Cascade)
  user             User                  @relation(fields: [userId], references: [id], onDelete: Cascade)
  submissions      ChallengeSubmission[]

  @@unique([challengeId, userId])
  @@map("challenge_participants")
}

model ChallengeSubmission {
  id             String               @id @default(uuid())
  challengeId    String
  participantId  String
  submissionUrl  String?
  description    String?
  status         SubmissionStatus     @default(SUBMITTED)
  demoUrl        String?
  files          Json                 @default("[]")
  finalRank      Int?
  images         String[]
  isWinner       Boolean              @default(false)
  judgeScores    Json                 @default("[]")
  judgedAt       DateTime?
  prizeAmount    Decimal?
  repositoryUrl  String?
  submittedAt    DateTime             @default(now())
  title          String?
  totalScore     Decimal              @default(0)
  videos         String[]
  winnerPosition Int?
  challenge      Challenge            @relation(fields: [challengeId], references: [id], onDelete: Cascade)
  participant    ChallengeParticipant @relation(fields: [participantId], references: [id], onDelete: Cascade)

  @@unique([challengeId, participantId])
  @@map("challenge_submissions")
}

model Notification {
  id                String                @id @default(uuid())
  userId            String
  title             String
  message           String
  type              NotificationType
  isRead            Boolean               @default(false)
  data              Json                  @default("{}")
  createdAt         DateTime              @default(now())
  actionText        String?
  actionUrl         String?
  channels          NotificationChannel[] @default([IN_APP])
  emailSent         Boolean               @default(false)
  emailSentAt       DateTime?
  expiresAt         DateTime?
  priority          NotificationPriority  @default(NORMAL)
  pushSent          Boolean               @default(false)
  pushSentAt        DateTime?
  readAt            DateTime?
  relatedEntityId   String?
  relatedEntityType String?
  smsSent           Boolean               @default(false)
  smsSentAt         DateTime?
  user              User                  @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@map("notifications")
}

model Review {
  id                  String       @id @default(uuid())
  reviewerId          String
  revieweeId          String
  comment             String?
  createdAt           DateTime     @default(now())
  communicationRating Int?
  isFeatured          Boolean      @default(false)
  overallRating       Int
  projectId           String?
  qualityRating       Int?
  respondedAt         DateTime?
  response            String?
  reviewType          ReviewType
  status              ReviewStatus @default(ACTIVE)
  timelinessRating    Int?
  title               String?
  updatedAt           DateTime     @updatedAt
  project             Project?     @relation(fields: [projectId], references: [id])
  reviewee            User         @relation("ReviewsOfUser", fields: [revieweeId], references: [id])
  reviewer            User         @relation("ReviewsByUser", fields: [reviewerId], references: [id])

  @@unique([projectId, reviewerId, revieweeId])
  @@map("reviews")
}

model Portfolio {
  id               String              @id @default(uuid())
  userId           String
  title            String
  description      String?
  category         String?
  tags             String[]
  clientName       String?
  projectDuration  String?
  technologiesUsed String[]
  featuredImageId  String?
  images           String[]
  videos           String[]
  liveUrl          String?
  repositoryUrl    String?
  caseStudyUrl     String?
  isFeatured       Boolean             @default(false)
  visibility       PortfolioVisibility @default(PUBLIC)
  status           PortfolioStatus     @default(ACTIVE)
  viewCount        Int                 @default(0)
  likeCount        Int                 @default(0)
  displayOrder     Int                 @default(0)
  createdAt        DateTime            @default(now())
  updatedAt        DateTime            @updatedAt
  user             User                @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@map("portfolios")
}

model Achievement {
  id               String              @id @default(uuid())
  name             String              @unique
  title            String
  description      String
  category         AchievementCategory
  criteria         Json
  experiencePoints Int                 @default(0)
  badgeIcon        String?
  badgeColor       String?
  rarity           AchievementRarity   @default(COMMON)
  displayOrder     Int                 @default(0)
  isActive         Boolean             @default(true)
  createdAt        DateTime            @default(now())
  userAchievements UserAchievement[]

  @@map("achievements")
}

model UserAchievement {
  id               String      @id @default(uuid())
  userId           String
  achievementId    String
  progress         Int         @default(0)
  maxProgress      Int         @default(1)
  isCompleted      Boolean     @default(false)
  completedAt      DateTime?
  experienceEarned Int         @default(0)
  metadata         Json        @default("{}")
  createdAt        DateTime    @default(now())
  achievement      Achievement @relation(fields: [achievementId], references: [id], onDelete: Cascade)
  user             User        @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@unique([userId, achievementId])
  @@map("user_achievements")
}

model UserAnalytics {
  id              String   @id @default(uuid())
  userId          String
  date            DateTime @db.Date
  loginCount      Int      @default(0)
  sessionDuration Int      @default(0)
  pageViews       Int      @default(0)
  jobsApplied     Int      @default(0)
  jobsWon         Int      @default(0)
  jobsCompleted   Int      @default(0)
  earnings        Decimal  @default(0.00)
  withdrawals     Decimal  @default(0.00)
  messagesSent    Int      @default(0)
  profileViews    Int      @default(0)
  createdAt       DateTime @default(now())
  user            User     @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@unique([userId, date])
  @@map("user_analytics")
}

enum UserRole {
  FREELANCER
  CLIENT
  ADMIN
  SUPER_ADMIN
}

enum UserStatus {
  ACTIVE
  INACTIVE
  SUSPENDED
  BANNED
  PENDING_VERIFICATION
}

enum AuthProvider {
  LOCAL
  GOOGLE
  APPLE
  LINKEDIN
}

enum BudgetType {
  FIXED
  HOURLY
}

enum DurationType {
  HOURS
  DAYS
  WEEKS
  MONTHS
}

enum ExperienceLevel {
  ENTRY
  INTERMEDIATE
  EXPERT
}

enum JobStatus {
  DRAFT
  OPEN
  IN_PROGRESS
  COMPLETED
  CANCELLED
  DISPUTED
}

enum JobVisibility {
  PUBLIC
  PRIVATE
  FEATURED
}

enum ApplicationStatus {
  PENDING
  ACCEPTED
  REJECTED
  WITHDRAWN
}

enum ProjectStatus {
  PLANNING
  ACTIVE
  ON_HOLD
  COMPLETED
  CANCELLED
  DISPUTED
}

enum ProjectRole {
  OWNER
  ADMIN
  MEMBER
}

enum PaymentSchedule {
  UPFRONT
  MILESTONE
  COMPLETION
}

enum MilestoneStatus {
  PENDING
  IN_PROGRESS
  SUBMITTED
  APPROVED
  REJECTED
  PAID
}

enum ChallengeStatus {
  UPCOMING
  ACTIVE
  COMPLETED
  CANCELLED
  DRAFT
  REGISTRATION_OPEN
  JUDGING
}

enum ChallengeVisibility {
  PUBLIC
  PRIVATE
  INVITE_ONLY
}

enum DifficultyLevel {
  BEGINNER
  INTERMEDIATE
  ADVANCED
  EXPERT
}

enum ParticipantStatus {
  REGISTERED
  ACTIVE
  SUBMITTED
  DISQUALIFIED
  WINNER
}

enum SubmissionStatus {
  SUBMITTED
  UNDER_REVIEW
  ACCEPTED
  REJECTED
  DRAFT
}

enum TransactionType {
  DEPOSIT
  WITHDRAWAL
  PAYMENT
  REFUND
  FEE
  BONUS
  PENALTY
}

enum TransactionStatus {
  PENDING
  COMPLETED
  FAILED
  CANCELLED
  PROCESSING
  REVERSED
}

enum WalletStatus {
  ACTIVE
  SUSPENDED
  CLOSED
}

enum PaymentMethodType {
  BANK_ACCOUNT
  CARD
  MOBILE_MONEY
  CRYPTO
}

enum PaymentMethodStatus {
  ACTIVE
  INACTIVE
  EXPIRED
  BLOCKED
}

enum ConversationType {
  DIRECT
  GROUP
  PROJECT
  SUPPORT
}

enum ConversationStatus {
  ACTIVE
  ARCHIVED
  BLOCKED
}

enum ConversationPriority {
  LOW
  NORMAL
  HIGH
  URGENT
}

enum ParticipantRole {
  OWNER
  ADMIN
  MODERATOR
  MEMBER
  OBSERVER
}

enum MessageType {
  TEXT
  IMAGE
  FILE
  SYSTEM
  AUDIO
  VIDEO
  ACTION
}

enum MessagePriority {
  LOW
  NORMAL
  HIGH
  URGENT
}

enum DeliveryStatus {
  SENT
  DELIVERED
  FAILED
  RETRY
}

enum ModerationStatus {
  PENDING
  APPROVED
  FLAGGED
  REMOVED
}

enum NotificationType {
  JOB_APPLICATION
  JOB_AWARDED
  MESSAGE
  PAYMENT
  SYSTEM
  PROJECT_UPDATE
  CHALLENGE
  MARKETING
}

enum NotificationChannel {
  IN_APP
  EMAIL
  PUSH
  SMS
}

enum NotificationPriority {
  LOW
  NORMAL
  HIGH
  URGENT
}

enum FileCategory {
  PROFILE_IMAGE
  PORTFOLIO
  PROJECT_FILE
  MESSAGE_ATTACHMENT
  DOCUMENT
  OTHER
}

enum FileVisibility {
  PUBLIC
  PRIVATE
  RESTRICTED
}

enum FileStatus {
  ACTIVE
  DELETED
  QUARANTINED
}

enum PortfolioVisibility {
  PUBLIC
  PRIVATE
  CLIENTS_ONLY
}

enum PortfolioStatus {
  ACTIVE
  DRAFT
  ARCHIVED
}

enum ReviewType {
  CLIENT_TO_FREELANCER
  FREELANCER_TO_CLIENT
}

enum ReviewStatus {
  ACTIVE
  HIDDEN
  DISPUTED
  REMOVED
}

enum AchievementCategory {
  PROFILE
  JOBS
  EARNINGS
  SOCIAL
  CHALLENGES
  MILESTONES
}

enum AchievementRarity {
  COMMON
  UNCOMMON
  RARE
  EPIC
  LEGENDARY
}

model Contract {
  id                String            @id @default(uuid())
  projectId         String            @unique
  jobId             String?
  clientId          String
  freelancerId      String
  title             String
  description       String?
  terms             String
  amount            Decimal
  currency          String            @default("NGN")
  paymentSchedule   PaymentSchedule   @default(MILESTONE)
  startDate         DateTime
  endDate           DateTime?
  status            ContractStatus    @default(ACTIVE)
  signedByClient    Boolean           @default(false)
  signedByFreelancer Boolean          @default(false)
  clientSignedAt    DateTime?
  freelancerSignedAt DateTime?
  completedAt       DateTime?
  terminatedAt      DateTime?
  terminationReason String?
  revisionLimit     Int               @default(3)
  deliverables      Json              @default("[]")
  milestones        Json              @default("[]")
  attachments       Json              @default("[]")
  createdAt         DateTime          @default(now())
  updatedAt         DateTime          @updatedAt
  project           Project           @relation(fields: [projectId], references: [id], onDelete: Cascade)
  job               Job?              @relation(fields: [jobId], references: [id])
  client            User              @relation("ClientContracts", fields: [clientId], references: [id])
  freelancer        User              @relation("FreelancerContracts", fields: [freelancerId], references: [id])
  disputes          Dispute[]

  @@map("contracts")
}

model Dispute {
  id                String          @id @default(uuid())
  projectId         String?
  contractId        String?
  jobId             String?
  raisedBy          String
  againstUser       String
  title             String
  description       String
  category          DisputeCategory @default(OTHER)
  priority          DisputePriority @default(NORMAL)
  status            DisputeStatus   @default(OPEN)
  amount            Decimal?
  currency          String          @default("NGN")
  evidence          Json            @default("[]")
  adminNotes        String?
  resolution        String?
  resolvedBy        String?
  resolvedAt        DateTime?
  escalatedAt       DateTime?
  dueDate           DateTime?
  createdAt         DateTime        @default(now())
  updatedAt         DateTime        @updatedAt
  project           Project?        @relation(fields: [projectId], references: [id])
  contract          Contract?       @relation(fields: [contractId], references: [id])
  job               Job?            @relation(fields: [jobId], references: [id])
  raisedByUser      User            @relation("RaisedDisputes", fields: [raisedBy], references: [id])
  againstUserRef    User            @relation("DisputesAgainst", fields: [againstUser], references: [id])
  resolver          User?           @relation("ResolvedDisputes", fields: [resolvedBy], references: [id])
  responses         DisputeResponse[]

  @@map("disputes")
}

model DisputeResponse {
  id          String    @id @default(uuid())
  disputeId   String
  userId      String
  message     String
  attachments Json      @default("[]")
  isAdminResponse Boolean @default(false)
  createdAt   DateTime  @default(now())
  dispute     Dispute   @relation(fields: [disputeId], references: [id], onDelete: Cascade)
  user        User      @relation(fields: [userId], references: [id])

  @@map("dispute_responses")
}

enum ContractStatus {
  DRAFT
  ACTIVE
  COMPLETED
  TERMINATED
  DISPUTED
}

enum DisputeCategory {
  PAYMENT
  QUALITY
  TIMELINE
  SCOPE
  COMMUNICATION
  BREACH_OF_CONTRACT
  OTHER
}

enum DisputeStatus {
  OPEN
  IN_REVIEW
  ESCALATED
  RESOLVED
  CLOSED
}

enum DisputePriority {
  LOW
  NORMAL
  HIGH
  URGENT
}

enum LoginStatus {
  SUCCESS
  FAILED
  BLOCKED
}

enum ProgressUpdateStatus {
  PENDING
  CONFIRMED
  CHANGE_REQUESTED
}

// Reward System Models
model Reward {
  id          String        @id @default(uuid())
  userId      String
  type        RewardType
  action      String        // 'profile_complete', 'first_job', etc.
  amount      Decimal       @default(0)
  points      Int           @default(0)
  status      RewardStatus  @default(PENDING)
  metadata    Json          @default("{}")
  expiresAt   DateTime?
  claimedAt   DateTime?
  createdAt   DateTime      @default(now())
  updatedAt   DateTime      @updatedAt
  user        User          @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@map("rewards")
}

model UserRewardStats {
  id              String   @id @default(uuid())
  userId          String   @unique
  totalEarned     Decimal  @default(0)
  totalPoints     Int      @default(0)
  currentStreak   Int      @default(0)
  longestStreak   Int      @default(0)
  tier            UserTier @default(BRONZE)
  nextTierPoints  Int      @default(1000)
  lifetimeEarned  Decimal  @default(0)
  monthlyEarned   Decimal  @default(0)
  weeklyEarned    Decimal  @default(0)
  lastRewardAt    DateTime?
  createdAt       DateTime @default(now())
  updatedAt       DateTime @updatedAt
  user            User     @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@map("user_reward_stats")
}

model Referral {
  id              String        @id @default(uuid())
  referrerId      String
  refereeId       String
  referralCode    String        @unique
  status          ReferralStatus @default(PENDING)
  rewardAmount    Decimal       @default(0)
  rewardPaid      Boolean       @default(false)
  rewardPaidAt    DateTime?
  completedAt     DateTime?
  metadata        Json          @default("{}")
  createdAt       DateTime      @default(now())
  updatedAt       DateTime      @updatedAt
  referrer        User          @relation("ReferrerReferrals", fields: [referrerId], references: [id])
  referee         User          @relation("RefereeReferrals", fields: [refereeId], references: [id])

  @@unique([referrerId, refereeId])
  @@map("referrals")
}

model UserStreak {
  id            String      @id @default(uuid())
  userId        String
  streakType    StreakType
  currentCount  Int         @default(0)
  maxCount      Int         @default(0)
  lastActiveAt  DateTime?
  isActive      Boolean     @default(true)
  metadata      Json        @default("{}")
  createdAt     DateTime    @default(now())
  updatedAt     DateTime    @updatedAt
  user          User        @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@unique([userId, streakType])
  @@map("user_streaks")
}

model Badge {
  id          String      @id @default(uuid())
  name        String      @unique
  title       String
  description String
  category    BadgeCategory
  icon        String?
  color       String      @default("#6B7280")
  rarity      BadgeRarity @default(COMMON)
  criteria    Json        @default("{}")
  isActive    Boolean     @default(true)
  createdAt   DateTime    @default(now())
  updatedAt   DateTime    @updatedAt
  userBadges  UserBadge[]

  @@map("badges")
}

model UserBadge {
  id          String    @id @default(uuid())
  userId      String
  badgeId     String
  earnedAt    DateTime  @default(now())
  isVisible   Boolean   @default(true)
  metadata    Json      @default("{}")
  user        User      @relation(fields: [userId], references: [id], onDelete: Cascade)
  badge       Badge     @relation(fields: [badgeId], references: [id], onDelete: Cascade)

  @@unique([userId, badgeId])
  @@map("user_badges")
}

model Leaderboard {
  id          String             @id @default(uuid())
  name        String             @unique
  title       String
  description String?
  type        LeaderboardType
  period      LeaderboardPeriod
  category    String?
  isActive    Boolean            @default(true)
  startDate   DateTime?
  endDate     DateTime?
  metadata    Json               @default("{}")
  createdAt   DateTime           @default(now())
  updatedAt   DateTime           @updatedAt
  entries     LeaderboardEntry[]

  @@map("leaderboards")
}

model LeaderboardEntry {
  id            String      @id @default(uuid())
  leaderboardId String
  userId        String
  rank          Int
  score         Decimal     @default(0)
  metadata      Json        @default("{}")
  period        String      // "2024-01", "2024-W01", etc.
  createdAt     DateTime    @default(now())
  updatedAt     DateTime    @updatedAt
  leaderboard   Leaderboard @relation(fields: [leaderboardId], references: [id], onDelete: Cascade)
  user          User        @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@unique([leaderboardId, userId, period])
  @@map("leaderboard_entries")
}

model RewardConfig {
  id          String      @id @default(uuid())
  action      String      @unique
  type        RewardType
  amount      Decimal     @default(0)
  points      Int         @default(0)
  isActive    Boolean     @default(true)
  conditions  Json        @default("{}")
  limits      Json        @default("{}")
  description String?
  createdAt   DateTime    @default(now())
  updatedAt   DateTime    @updatedAt

  @@map("reward_configs")
}

model Campaign {
  id          String         @id @default(uuid())
  name        String         @unique
  title       String
  description String?
  type        CampaignType
  status      CampaignStatus @default(DRAFT)
  startDate   DateTime
  endDate     DateTime
  budget      Decimal        @default(0)
  spent       Decimal        @default(0)
  conditions  Json           @default("{}")
  rewards     Json           @default("{}")
  metadata    Json           @default("{}")
  createdAt   DateTime       @default(now())
  updatedAt   DateTime       @updatedAt

  @@map("campaigns")
}

enum RewardType {
  ONBOARDING
  ACTIVITY
  REFERRAL
  MILESTONE
  CAMPAIGN
  BONUS
}

enum RewardStatus {
  PENDING
  COMPLETED
  EXPIRED
  CANCELLED
}

enum UserTier {
  BRONZE
  SILVER
  GOLD
  PLATINUM
  DIAMOND
}

enum ReferralStatus {
  PENDING
  COMPLETED
  EXPIRED
  CANCELLED
}

enum StreakType {
  DAILY_LOGIN
  WEEKLY_ACTIVITY
  JOB_COMPLETION
  CHALLENGE_PARTICIPATION
}

enum BadgeCategory {
  ACHIEVEMENT
  SKILL
  MILESTONE
  SPECIAL
  SEASONAL
}

enum BadgeRarity {
  COMMON
  UNCOMMON
  RARE
  EPIC
  LEGENDARY
}

enum LeaderboardType {
  EARNINGS
  JOBS_COMPLETED
  CHALLENGES_WON
  REFERRALS
  POINTS
}

enum LeaderboardPeriod {
  DAILY
  WEEKLY
  MONTHLY
  QUARTERLY
  YEARLY
  ALL_TIME
}

enum CampaignType {
  ONBOARDING
  RETENTION
  ENGAGEMENT
  SEASONAL
  REFERRAL
}

enum CampaignStatus {
  DRAFT
  ACTIVE
  PAUSED
  COMPLETED
  CANCELLED
}
